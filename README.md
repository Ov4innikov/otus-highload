# Проект otus-highload

## Локальный запуск прилоижения(social-network-backend):

1. Для запуска нужны JRE 21, mvn и docker.
2. Образ приложения выложен в Docker Hub - wolf2010502/social-network-backend:latest
3. Запустите проект с необходимыми зависимостями запустив docker compose файл - [docker-compose](./project-resources/docker/docker-compose.yml)
4. У сервиса есть свагер - http://localhost:8080/swagger-ui/index.html#

## Описание домашних заданий

### Домашнее задание 1
Заготовка для социальной сети

Цель:
В результате выполнения ДЗ вы создадите базовый скелет социальной сети, который будет развиваться в дальнейших ДЗ.
В данном задании тренируются навыки:

декомпозиции предметной области;
построения элементарной архитектуры проекта

Описание/Пошаговая инструкция выполнения домашнего задания:
Требуется разработать создание и просмотр анкет в социальной сети.

Функциональные требования:

Простейшая авторизация пользователя.
Возможность создания пользователя, где указывается следующая информация:
Имя
Фамилия
Дата рождения
Пол
Интересы
Город
Страницы с анкетой.

Нефункциональные требования:

Любой язык программирования
В качестве базы данных использовать PostgreSQL (при желании и необходимости любую другую SQL БД)
Не использовать ORM
Программа должна представлять из себя монолитное приложение.
Не рекомендуется использовать следующие технологии:
Репликация
Шардирование
Индексы
Кэширование

Для удобства разработки и проверки задания можно воспользоваться этой спецификацией и реализовать в ней методы:
/login
/user/register
/user/get/{id}

Фронт опционален.

Сделать инструкцию по локальному запуску приложения, приложить Postman-коллекцию.

ДЗ принимается в виде исходного кода на github и Postman-коллекции.

Критерии оценки:
Оценка происходит по принципу зачет/незачет.
Требования:
Есть возможность авторизации, регистрации, получение анкет по ID.
Отсутствуют SQL-инъекции.
Пароль хранится безопасно.

### Домашнее задание 2
Производительность индексов

Цель:
В результате выполнения ДЗ вы воспользуетесь/создадите набор тестовых данных для проведения нагрузочного тестирования, подберете наиболее подходящие индексы и проведете тесты производительности.
В данном задании тренируются навыки:

(опционально) генерация тестовых данных;
работа с индексами;
нагрузочное тестирование;

Описание/Пошаговая инструкция выполнения домашнего задания:
Сгенерировать любым способ 1,000,000 анкет. Имена и Фамилии должны быть реальными, чтобы учитывать селективность индекса. Так же можно воспользовать уже готовым списком как основой.
Реализовать функционал поиска анкет по префиксу имени и фамилии (одновременно) в вашей социальной сети (реализовать метод /user/search из спецификации) (запрос в форме firstName LIKE ? and secondName LIKE ?). Сортировать вывод по id анкеты.
Провести нагрузочные тесты этого метода. Поиграть с количеством одновременных запросов. 1/10/100/1000.
Построить графики и сохранить их в отчет
Сделать подходящий индекс.
Повторить пункт 3 и 4.
В качестве результата предоставить отчет в котором должны быть:
графики latency до индекса;
графики throughput до индекса;
графики latency после индекса;
графики throughput после индекса;
запрос добавления индекса;
explain запросов после индекса;
объяснение почему индекс именно такой;

ДЗ принимается в виде отчета по выполненной работе.

Критерии оценки:
Оценка происходит по принципу зачет/незачет.
Требования:

Правильно выбраны индексы.
Нагрузочное тестирование проведено и результаты адекватны.
В случае генерации тестовых данных самостоятельно, убедиться что эти данные "похожи" на настоящие.

### Домашнее задание 3
Репликация

Цель:
В результате выполнения ДЗ вы настроите разные виды репликации, протестируете их влияние на производительность системы и убедитесь, что в случае сихнронной репликации вы не теряете данные при аварии.
В данном задании тренируются навыки:

обеспечение отказоустойчивости проекта;
администрирование PostgreSQL;
настройка репликации;
проведение нагрузочных тестов.

Описание/Пошаговая инструкция выполнения домашнего задания:
Настраиваем асинхронную репликацию.
Выбираем 2 запроса на чтение (/user/get/{id} и /user/search из спецификации) и переносим их на чтение со слейва.
Делаем нагрузочный тест по методам (/user/get/{id} и /user/search из спецификации), которые перевели на слейв до и после репликации. Замеряем нагрузку мастера (CPU, la, disc usage, memory usage).
Настроить 2 слейва и 1 мастер.
Включить потоковую репликацию.
(Опционально) воспользоваться одним из кластерных расширения Postgres (например patroni).
Настроить кворумную синхронную репликацию.
Создать нагрузку на запись в любую тестовую таблицу. На стороне, которой нагружаем считать, сколько строк мы успешно записали.
Убиваум одну из реплик (kill -9, docker stop)
Заканчиваем нагрузку на запись.
Выбираем самый свежий слейв. Промоутим его до мастера. Переключаем на него второй слейв.
Проверяем, есть ли потери транзакций.

Форма сдачи ДЗ
Предоставить ссылку на исходный код (github, gitlab, etc)
Предоставить докеризированное приложение, которое можно запустить при помощи docker-compose (может лежать рядом с исходным кодом) ИЛИ развернутое приложение, доступное извне ИЛИ инструкция по запуску
Предоставить отчет в свободной форме о проделанное работе

Критерии оценки:
Оценка происходит по принципу зачет/незачет.

Требования:
В отчете корректно описано, как настроена репликация.
2 запроса переведено на чтение со слейва.
Нагрузочное тестирование показало, что нагрузка перешла на слейв.
Проведен эксперимент по потере и непотере транзакций при аварийной остановке master.

### Домашнее задание 4
Лента постов от друзей

Цель:
В результате выполнения ДЗ вы создадите ленту постов друзей социальной сети
В данном задании тренируются навыки:

работа с кешами;
работа с очередями;
проектирование масштабируемых архитектур.

Описание/Пошаговая инструкция выполнения домашнего задания:
Реализовать функционал:

(опционально) Добавление/удаление друга (методы /friend/add, /friend/delete из спецификации)
(опционально) CRUD для постов пользователей (методы /post/create, /post/update, /post/delete, /post/get из спецификации)
Лента постов друзей (метод /post/feed из спецификации

Дополнительные материалы

ссылка на сгенерированные тексты постов (опциально, можно сгенерировать самостоятельно)

Требования к ленте постов друзей

Лента постов друзей формируется на уровне кешей
(Опционально) Формирование ленты производить через постановку задачи в очередь на часть друзей, чтобы избежать "эффекта Леди Гаги"/celebrity (один пользователь пишет сильно больше среднего)
В ленте держать последние 1000 обновлений друзей
Лента должна кешироваться

Форма сдачи ДЗ

Предоставить ссылку на исходный код (github, gitlab, etc)
Предоставить докеризированное приложение, которое можно запустить при помощи docker-compose (может лежать рядом с исходным кодом) ИЛИ развернутое приложение, доступное извне

Критерии оценки:
Оценка происходит по принципу зачет/незачет.
Требования:

Верно работает инвалидация кеша.
(опционально) Обновление лент работает через очередь.
Есть возможность перестройки кешей из СУБД.

### Домашнее задание 5
Онлайн обновление ленты новостей

Цель:
Разработать WebSocket сервер, при помощи которого подключенные клиенты будут сразу получать обновления постов своих друзей.
Такой подход позволит сэкономить ресурсы и обновлять молниеносно ленты активных клиентов.


Описание/Пошаговая инструкция выполнения домашнего задания:
Реализовать функционал:

Создание поста (метод /post/create из спецификации)
Отправка сообщений в канал /post/feed/posted через websocket согласно спецификации

Требования

при добавлении нового поста друга подписчику websocket'а должно приходить событие о новом посте, тем самым обеспечивая обновление ленты в реальном времени
при реализации обязательно обеспечить отправку только целевым пользователям это событие (можно применить Routing Key из RabbitMQ)

Форма сдачи ДЗ

Предоставить ссылку на исходный код (github, gitlab, etc)
Предоставить докеризированное приложение, которое можно запустить при помощи docker-compose (может лежать рядом с исходным кодом) ИЛИ развернутое приложение, доступное извне ИЛИ инструкция по запуску

Критерии оценки:
Оценка происходит по принципу зачет/незачет.
Требования:

При добавлении поста у друга, лента должна обновляться автоматически (с небольшой задержкой).
Корректная работа сервиса вебсокетов.
Линейная масштабируемость сервиса вебсокетов.
Описан процесс масштабирования RabbitMQ.

